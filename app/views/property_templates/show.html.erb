<% if can? :manage, @property %>

<div class="row mb-0">
  <div class="col-lg-5 offset-lg-2 col-9">
    <h5 class="text-info text-left text-uppercase mb-0">
      <%= @property.address %>
    </h5>
    <p class="text-secondary mt-0 mb-2 pb-0"><small><%= @property.city + ", " + @property.state + " " + @property.zipcode %></small></p>
  </div>
  <div class="col-lg-3 col-3">
    <p class="text-dark text-center font-weight-bold mb-0">
      <% if  @property.prices.count == 0 %>
        <a href="/prices/new/<%= @property.id %>">add price</a>
      <% else %>
        <%= number_to_currency(@property.prices.order(date: :desc).first.amount, precision: 0) %>
      <% end %>
    </p>
    <p class="text-secondary text-center mb-2 pt-0 pb-0"> <small>
        <a href="/properties/prices/<%= @property.id %>">
          view/change</a>
      </small></p>
  </div>
</div>

<div class="row mb-0">
  <div class="col-lg-8 offset-lg-2">
    <a data-toggle="collapse" class="icon-more" href="#collapseExample" role="button">
      <i class="fas fa-ellipsis-h"  data-toggle="tooltip" title="More Options"></i>
    </a>

    <div class="collapse" id="collapseExample">
      <div class="card card-body border-white">
        <div class="row mb-4">
          <div class="col-lg-4 offset-lg-2 col-6">
            <a class="btn btn-outline-info btn-block text-center custom-info-button" href="../report_type/<%=@property.id%>">
              <i class="far fa-file-alt fa-2x my-2"></i>
              <h5 class="font-weight-light">Reports</h5>
            </a>
          </div>

          <div class="col-lg-4 col-6">
            <a class="btn btn-outline-info btn-block text-center custom-info-button" href="/properties/<%= @property.id %>/attachments">
              <i class="far fa-images fa-2x my-2"></i>
              <h5 class="font-weight-light">Attachments</h5>
            </a>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-8 offset-lg-2 col-12">
            <a href="/properties/<%= @property.id %>/edit" class="btn btn-block btn-outline-info">
              Edit Property
            </a>
          </div>
        </div>
      </div>
    </div>
    <hr>
  </div>
</div>
 <div class="row mb-0">
  <div class="col-md-8 offset-md-2">
    <div class="filter-bx d-flex flex-wrap mb-4">
      <h4 class="my-auto">Activity Log</h4>
      <div class="d-block fb-actions my-auto ml-3">
        <a id = "asc" data-toggle="tooltip" title="Ascending"><span class="fas fa-chevron-up"></span> </a>
        <a id = "desc" data-toggle="tooltip" data-placement="bottom" title="Descending"><span class="fas fa-chevron-down"></span> </a>
      </div>
      <a class="d-block ml-auto text-center icon-add text-info my-auto" href="/properties/new" data-toggle="tooltip" title="Add new property">
        <i>+</i>
      </a>
    </div>
  </div>
</div>

<div id="order_manage">
  <%= render partial: 'property_templates/properties_activity', locals: {activities: @property.activities.order(date: :desc)} %>
</div>

<% end %>
<script>
    $('[data-toggle="tooltip"]').tooltip();
    $('#asc').click(function(){
      $('#order_manage').empty();
      $("#order_manage").append("<%= j render partial: 'property_templates/properties_activity', locals: {activities: @property.activities.order(date: :asc)} %>");
      for_collapse();
    })
    $('#desc').click(function(){
      $('#order_manage').empty();
      $("#order_manage").append("<%= j render partial: 'property_templates/properties_activity', locals: {activities: @property.activities.order(date: :desc)} %>");
      for_collapse();
    })
    for_collapse();

    function for_collapse() {
      $(".collapse.in").each(function(){
        $(this).siblings(".card-heading").find(".icon-arrow").addClass("rotate");
      });

      // Toggle plus minus icon on show hide of collapse element
      $(".collapse").on('show.bs.collapse', function(){
        $(".collapse").parent().find(".rotate").removeClass("rotate");
        $(".collapse").removeClass("show");
        $(".collapse").siblings().children('p').show();
        $(this).siblings().children('p').hide();
        $(this).parent().find(".icon-arrow").addClass("rotate");
      }).on('hide.bs.collapse', function(){
        $(this).parent().find(".icon-arrow").removeClass("rotate");
        $(this).siblings().children('p').show();
      });
    }
</script>
